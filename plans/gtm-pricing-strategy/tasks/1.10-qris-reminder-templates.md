# Task 1.10: QRIS Reminder Email Templates

## üéØ Goal

Create React Email templates for QRIS renewal reminders using Resend and @react-email/components.

## üìç Context

**Prerequisites:**
- Task 1.8 completed (qrisRenewalReminders schema)
- Task 1.9 completed (reminder scheduler)
- Email package already set up with Resend

**Reminder Types (Kebab-Case):**
- `renewal-25-days`: Friendly reminder (5 days before expiry)
- `renewal-29-days`: Urgent reminder (1 day before expiry)
- `renewal-30-days`: Grace period warning (on expiry day)

**Existing Email Infrastructure:**
- Uses `@react-email/components` with Tailwind
- Resend for email delivery
- Templates in `packages/email/templates/`
- Components in `packages/email/components/`

## PRD

```json
{
  "category": "content",
  "description": "Create React Email templates for QRIS renewal reminders",
  "steps": [
    "Create RenewalReminder email component",
    "Add Indonesian language content",
    "Style with Tailwind and existing components",
    "Export from email package index"
  ],
  "passes": false
}
```

## üé¨ Success Criteria

- [ ] React Email templates for all reminder types
- [ ] Uses kebab-case for reminder types
- [ ] Indonesian language content
- [ ] Uses existing Button, Card components
- [ ] Consistent with Welcome email design
- [ ] Mobile-friendly design
- [ ] Exported from email package

## üìù Implementation

### Create Renewal Reminder Template

**File**: `packages/email/templates/renewal-reminder.tsx`

```tsx
import {
  Body,
  Container,
  Head,
  Hr,
  Html,
  Img,
  Link,
  Preview,
  Section,
  Text,
} from "@react-email/components";
import { Button } from "@repo/email/components/button";
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from "@repo/email/components/card";
import { Tailwind } from "@repo/email/tailwind";

// Kebab-case for reminder types per Convex convention
export type ReminderType =
  | "renewal-25-days"
  | "renewal-29-days"
  | "renewal-30-days";

interface RenewalReminderProps {
  readonly name: string;
  readonly reminderType: ReminderType;
  readonly expiresAt: number;
  readonly renewalLink: string;
}

export const RenewalReminder = ({
  name,
  reminderType,
  expiresAt,
  renewalLink,
}: RenewalReminderProps) => {
  const expiryDate = new Date(expiresAt).toLocaleDateString("id-ID", {
    day: "numeric",
    month: "long",
    year: "numeric",
  });

  const config = getReminderConfig(reminderType);

  return (
    <Html>
      <Head />
      <Tailwind>
        <Body className="bg-background font-sans text-foreground antialiased">
          <Preview>{config.preview}</Preview>
          <Container className="mx-auto my-8 max-w-md p-5">
            <Section className="mt-6">
              <Img
                alt="Nakafa"
                className="mx-auto"
                height="64"
                src="https://nakafa.com/logo.png"
                width="64"
              />
            </Section>

            <Section className="mt-6">
              <Text className="m-0 font-semibold text-2xl text-foreground tracking-tight">
                {config.title}
              </Text>
            </Section>

            <Section className="mt-6">
              <Text className="text-base text-foreground leading-6">
                Halo {name},
              </Text>
              <Text className="mt-4 text-base text-foreground leading-6">
                {config.message(expiryDate)}
              </Text>
            </Section>

            <Section className="mt-6 text-center">
              <Button
                href={renewalLink}
                size="lg"
                variant={config.buttonVariant}
              >
                {config.buttonText}
              </Button>
            </Section>

            <Card
              className="mt-6 w-full border-border bg-muted/30"
              style={{ width: "100%" }}
            >
              <CardHeader
                className="w-full border-border/50"
                style={{ width: "100%" }}
              >
                <CardTitle className="text-lg">
                  {config.cardTitle}
                </CardTitle>
              </CardHeader>
              <CardContent className="w-full" style={{ width: "100%" }}>
                {config.cardContent}
              </CardContent>
            </Card>

            <Section className="mt-6">
              <Text className="mt-4 text-base text-foreground leading-6">
                {config.closing}
                <br />
                Tim Nakafa
              </Text>
            </Section>

            <Hr className="mx-0 my-6 w-full border border-border" />

            <Section className="text-center">
              <Text className="m-0 text-muted-foreground text-xs leading-relaxed">
                ¬© {new Date().getFullYear()} PT. Nakafa Tekno Kreatif. All
                rights reserved.
              </Text>
              <Text className="m-0 mt-1 text-muted-foreground text-xs leading-relaxed">
                Taman Sukahati Permai H6, Kab. Bogor
              </Text>
              <Section align="center" className="mt-4 w-auto">
                <Link
                  className="text-muted-foreground text-xs"
                  href="https://nakafa.com/en/privacy-policy"
                  style={{ textDecoration: "underline" }}
                >
                  Privacy Policy
                </Link>
                <span className="mx-2 text-muted-foreground">¬∑</span>
                <Link
                  className="text-muted-foreground text-xs"
                  href="https://nakafa.com/en/terms-of-service"
                  style={{ textDecoration: "underline" }}
                >
                  Terms of Service
                </Link>
              </Section>
            </Section>
          </Container>
        </Body>
      </Tailwind>
    </Html>
  );
};

interface ReminderConfig {
  preview: string;
  title: string;
  message: (expiryDate: string) => string;
  buttonText: string;
  buttonVariant:
    | "default"
    | "destructive"
    | "secondary"
    | "outline"
    | "ghost"
    | "link";
  cardTitle: string;
  cardContent: React.ReactNode;
  closing: string;
}

function getReminderConfig(type: ReminderType): ReminderConfig {
  switch (type) {
    case "renewal-25-days":
      return {
        preview: "Nakafa Pro akan berakhir dalam 5 hari - Perpanjang sekarang",
        title: "Nakafa Pro akan berakhir dalam 5 hari üîî",
        message: (date) =>
          `Nakafa Pro kamu akan berakhir pada ${date}. Jangan khawatir, kamu bisa memperpanjang kapan saja dengan mudah.`,
        buttonText: "Perpanjang Sekarang",
        buttonVariant: "default",
        cardTitle: "Benefit yang akan kamu lewatkan:",
        cardContent: (
          <>
            <Text className="m-0 mb-2 text-sm">
              ‚Ä¢ AI Tutor unlimited
            </Text>
            <Text className="m-0 mb-2 text-sm">
              ‚Ä¢ Akses semua 2,784 materi
            </Text>
            <Text className="m-0 mb-2 text-sm">
              ‚Ä¢ Study plan personal
            </Text>
            <Text className="m-0 text-sm">
              ‚Ä¢ Latihan soal tanpa batas
            </Text>
          </>
        ),
        closing: "Terima kasih telah belajar bersama kami!",
      };

    case "renewal-29-days":
      return {
        preview: "‚è∞ Nakafa Pro berakhir besok! Perpanjang sekarang",
        title: "‚è∞ Nakafa Pro berakhir besok!",
        message: (date) =>
          `PENTING: Nakafa Pro kamu berakhir besok (${date}). Perpanjang sekarang agar tidak kehilangan akses.`,
        buttonText: "Perpanjang Sekarang - Rp 89.000",
        buttonVariant: "destructive",
        cardTitle: "Setelah berakhir:",
        cardContent: (
          <>
            <Text className="m-0 mb-2 text-sm text-destructive">
              ‚Ä¢ Kembali ke versi gratis (20 AI messages/hari)
            </Text>
            <Text className="m-0 mb-2 text-sm text-destructive">
              ‚Ä¢ Akses materi premium terbatas
            </Text>
            <Text className="m-0 text-sm text-destructive">
              ‚Ä¢ Progress belajar tetap tersimpan
            </Text>
          </>
        ),
        closing: "Jangan lewatkan kesempatan ini!",
      };

    case "renewal-30-days":
      return {
        preview: "‚ö†Ô∏è Nakafa Pro telah berakhir - Grace period 3 hari",
        title: "‚ö†Ô∏è Nakafa Pro telah berakhir",
        message: (date) =>
          `Nakafa Pro kamu telah berakhir hari ini (${date}). GOOD NEWS: Kamu masih punya akses Pro selama 3 hari sebagai grace period.`,
        buttonText: "Perpanjang Sekarang",
        buttonVariant: "secondary",
        cardTitle: "Grace Period 3 Hari",
        cardContent: (
          <>
            <Text className="m-0 mb-2 text-sm">
              ‚úÖ Akses Pro masih aktif selama 3 hari
            </Text>
            <Text className="m-0 mb-2 text-sm">
              ‚úÖ Semua progress belajar tersimpan
            </Text>
            <Text className="m-0 text-sm text-muted-foreground">
              Setelah 3 hari, akses akan otomatis berubah ke versi gratis.
            </Text>
          </>
        ),
        closing: "Perpanjang sekarang untuk melanjutkan tanpa gangguan!",
      };

    default:
      throw new Error(`Unknown reminder type: ${type}`);
  }
}

// Preview props for React Email dev server
RenewalReminder.PreviewProps = {
  name: "Budi",
  reminderType: "renewal-25-days" as ReminderType,
  expiresAt: Date.now() + 5 * 24 * 60 * 60 * 1000,
  renewalLink: "https://nakafa.com/pricing?renewal=abc123",
};

export default RenewalReminder;
```

### Export from Email Package

**File**: Update `packages/email/index.ts`

```typescript
import { keys } from "@repo/email/keys";
import { Resend } from "resend";

export const resend = new Resend(keys().RESEND_TOKEN);

// Export templates
export { Welcome } from "./templates/welcome";
export { RenewalReminder, type ReminderType } from "./templates/renewal-reminder";

// Export components
export { Button } from "./components/button";
export { Card, CardContent, CardHeader, CardTitle } from "./components/card";
export { WrapperIcon } from "./components/wrapper";
export { EmailTailwind as Tailwind } from "./tailwind";
```

### Install Required Dependencies

**File**: Update `packages/email/package.json`

```json
{
  "dependencies": {
    "@react-email/components": "latest",
    "@react-email/render": "latest",
    "resend": "latest"
  }
}
```

Then run:
```bash
pnpm install
```

## üöÄ Next Steps

After completing this task:

1. **Test**: Preview emails with `pnpm email:dev`
2. **Send test**: Use Resend to send test emails
3. **Next task**: Task 1.11 - QRIS Renewal Token System

## üîó Related Tasks

- Task 1.8: QRIS Reminders Schema (prerequisite)
- Task 1.9: QRIS Reminder Scheduler (prerequisite)
- Task 1.11: QRIS Renewal Token System (next)

## ‚ö†Ô∏è Important Notes

### Kebab-Case Convention

Per Convex best practices, use hyphens (`-`) not underscores (`_`) for literal string values:

```typescript
// Good (kebab-case)
export type ReminderType = "renewal-25-days" | "renewal-29-days";

// Bad (snake_case)
export type ReminderType = "renewal_25_days" | "renewal_29_days";
```

### React Email Benefits

1. **Type-safe** - TypeScript support
2. **Component-based** - Reuse existing components
3. **Tailwind support** - Consistent styling
4. **Dev server** - Preview emails locally
5. **Resend integration** - Easy sending

### Testing Locally

```bash
# Start email dev server
pnpm --filter email dev

# Preview at http://localhost:3000
```

### Adding New Templates

To add Day 27 reminder:

1. Add to `ReminderType` union:
```typescript
export type ReminderType =
  | "renewal-25-days"
  | "renewal-27-days"  // Add this
  | "renewal-29-days"
  | "renewal-30-days";
```

2. Add case in `getReminderConfig` switch statement

3. Update `REMINDER_SCHEDULE` in Task 1.9:
```typescript
const REMINDER_SCHEDULE = [
  { type: "renewal-25-days", daysBeforeExpiry: 5 },
  { type: "renewal-27-days", daysBeforeExpiry: 3 },  // Add this
  { type: "renewal-29-days", daysBeforeExpiry: 1 },
  { type: "renewal-30-days", daysBeforeExpiry: 0 },
];
```

### Progress Tracking

After completing this task, update `plans/gtm-pricing-strategy/progress.txt`.
