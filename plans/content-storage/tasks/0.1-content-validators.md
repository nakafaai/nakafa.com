# Task 0.1: Content Validators

## Goal

Create shared Convex validators for content storage schema, matching existing Zod schemas in `packages/contents/_types/`.

## Context

Convex uses its own validator system (`v.union`, `v.literal`, etc.) separate from Zod. We need to create Convex equivalents of existing Zod schemas to ensure type safety and consistency.

## PRD

```json
{
  "category": "architecture",
  "description": "Create contentValidators.ts with all shared validators for content types",
  "steps": [
    "Create file at packages/backend/convex/lib/contentValidators.ts",
    "Define all validators matching Zod schemas",
    "Export types using Infer<typeof validator>",
    "Verify lint passes"
  ],
  "passes": false
}
```

## Success Criteria

- [ ] File created at correct path
- [ ] All validators match existing Zod schemas
- [ ] Types exported for each validator
- [ ] No lint errors
- [ ] No TypeScript errors

## Commands

```bash
pnpm lint
pnpm typecheck
```

## Implementation

### File: `packages/backend/convex/lib/contentValidators.ts`

```typescript
import type { Infer } from "convex/values";
import { v } from "convex/values";

export const localeValidator = v.union(v.literal("en"), v.literal("id"));
export type Locale = Infer<typeof localeValidator>;

export const contentTypeValidator = v.union(
  v.literal("article"),
  v.literal("subject"),
  v.literal("exercise")
);
export type ContentType = Infer<typeof contentTypeValidator>;

export const articleCategoryValidator = v.literal("politics");
export type ArticleCategory = Infer<typeof articleCategoryValidator>;

export const subjectCategoryValidator = v.union(
  v.literal("elementary-school"),
  v.literal("middle-school"),
  v.literal("high-school"),
  v.literal("university")
);
export type SubjectCategory = Infer<typeof subjectCategoryValidator>;

export const gradeValidator = v.union(
  v.literal("1"),
  v.literal("2"),
  v.literal("3"),
  v.literal("4"),
  v.literal("5"),
  v.literal("6"),
  v.literal("7"),
  v.literal("8"),
  v.literal("9"),
  v.literal("10"),
  v.literal("11"),
  v.literal("12"),
  v.literal("bachelor"),
  v.literal("master"),
  v.literal("phd")
);
export type Grade = Infer<typeof gradeValidator>;

export const materialValidator = v.union(
  v.literal("mathematics"),
  v.literal("physics"),
  v.literal("chemistry"),
  v.literal("biology"),
  v.literal("geography"),
  v.literal("economy"),
  v.literal("history"),
  v.literal("informatics"),
  v.literal("geospatial"),
  v.literal("sociology"),
  v.literal("ai-ds"),
  v.literal("game-engineering"),
  v.literal("computer-science"),
  v.literal("technology-electro-medical"),
  v.literal("political-science"),
  v.literal("informatics-engineering"),
  v.literal("international-relations")
);
export type Material = Infer<typeof materialValidator>;

export const exercisesCategoryValidator = v.union(
  v.literal("high-school"),
  v.literal("middle-school")
);
export type ExercisesCategory = Infer<typeof exercisesCategoryValidator>;

export const exercisesTypeValidator = v.union(
  v.literal("grade-9"),
  v.literal("tka"),
  v.literal("snbt")
);
export type ExercisesType = Infer<typeof exercisesTypeValidator>;

export const exercisesMaterialValidator = v.union(
  v.literal("mathematics"),
  v.literal("quantitative-knowledge"),
  v.literal("mathematical-reasoning"),
  v.literal("general-reasoning"),
  v.literal("indonesian-language"),
  v.literal("english-language"),
  v.literal("general-knowledge"),
  v.literal("reading-and-writing-skills")
);
export type ExercisesMaterial = Infer<typeof exercisesMaterialValidator>;
```

## Validator Mapping

| Convex Validator | Zod Source | Values |
|------------------|------------|--------|
| `localeValidator` | N/A (common) | "en", "id" |
| `contentTypeValidator` | N/A (new) | "article", "subject", "exercise" |
| `articleCategoryValidator` | `ArticleCategorySchema` | "politics" |
| `subjectCategoryValidator` | `SubjectCategorySchema` | 4 values |
| `gradeValidator` | `GradeSchema` | 15 values |
| `materialValidator` | `MaterialSchema` | 17 values |
| `exercisesCategoryValidator` | `ExercisesCategorySchema` | 2 values |
| `exercisesTypeValidator` | `ExercisesTypeSchema` | 3 values |
| `exercisesMaterialValidator` | `ExercisesMaterialSchema` | 8 values |

## Next Steps

After this task:
- Next: Task 0.2 (authors schema)
- Dependencies: None

## Related Tasks

- Task 0.2-0.5: Use these validators in schema definitions
- Task 0.6: Main schema import

## Notes

### Why Separate from Zod?

Convex validators run on the server and are used for:
1. Schema definition (`defineTable`)
2. Argument validation (`args: { ... }`)
3. Runtime type checking

Zod schemas in `packages/contents/_types/` are for:
1. Client-side validation
2. MDX file parsing
3. Type generation

Both should stay in sync but serve different purposes.

### Convex Best Practices Applied

- Use `v.union(v.literal(...))` for enums
- Export types with `Infer<typeof validator>`
- Keep validators in `lib/` for reuse across schemas
