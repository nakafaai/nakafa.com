# Task 0.2: Create contentAudios Schema

## Goal
Define database schema for audio content tables.

## File
`packages/backend/convex/audioStudies/schema.ts`

## Implementation

```typescript
import { defineTable } from "convex/server";
import { v } from "convex/values";
import {
  audioStatusValidator,
  localeValidator,
  voiceSettingsValidator,
} from "@repo/backend/convex/lib/contentValidators";
import { literals } from "convex-helpers/validators";

const tables = {
  contentAudios: defineTable({
    contentId: v.union(v.id("articleContents"), v.id("subjectSections")),
    contentType: literals("article", "subject"),
    locale: localeValidator,
    contentHash: v.string(),
    voiceId: v.string(),
    voiceSettings: v.optional(voiceSettingsValidator),
    status: audioStatusValidator,
    script: v.optional(v.string()),
    audioStorageId: v.optional(v.id("_storage")),
    audioDuration: v.optional(v.number()),
    audioSize: v.optional(v.number()),
    errorMessage: v.optional(v.string()),
    failedAt: v.optional(v.number()),
    generationAttempts: v.number(),
    updatedAt: v.number(),
  })
    .index("content_voice", ["contentId", "contentType", "voiceId"])
    .index("content", ["contentId", "contentType"])
    .index("status", ["status"]),

  userContentAudios: defineTable({
    userId: v.id("users"),
    contentAudioId: v.id("contentAudios"),
    contentId: v.union(v.id("articleContents"), v.id("subjectSections")),
    contentType: literals("article", "subject"),
    playCount: v.number(),
    lastPlayedAt: v.optional(v.number()),
    updatedAt: v.number(),
  })
    .index("user", ["userId"])
    .index("user_content", ["userId", "contentId", "contentType"])
    .index("contentAudio", ["contentAudioId"]),
};

export default tables;
```

## Notes

- Uses `v.id()` for table references (standard Convex in schemas)
- Uses `literals()` from convex-helpers for contentType discriminator
- Uses `v.optional()` for fields that don't exist until generated (script, audio, etc.)
- Uses shared validators from `contentValidators`: `localeValidator`, `audioStatusValidator`, `voiceSettingsValidator`

## Update Main Schema

Add to `packages/backend/convex/schema.ts`:

```typescript
import audioStudiesSchema from "@repo/backend/convex/audioStudies/schema";

export default defineSchema({
  ...existingSchemas,
  ...audioStudiesSchema,
});
```

## Commands
```bash
pnpm --filter @repo/backend typecheck
```
