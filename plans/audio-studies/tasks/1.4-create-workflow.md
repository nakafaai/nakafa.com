# Task 1.4: Create Audio Studies Workflow

## Goal
Create workflow to orchestrate audio generation pipeline.

## File
`packages/backend/convex/audioStudies/workflows.ts`

## Implementation

```typescript
import { workflow } from "@repo/backend/convex/workflow";
import { internal } from "@repo/backend/convex/_generated/api";
import { v } from "convex/values";
import { vv } from "@repo/backend/convex/lib/validators";

export const generate = workflow.start({
  args: {
    contentId: v.union(vv.id("articleContents"), vv.id("subjectSections")),
    contentType: v.union(v.literal("article"), v.literal("subject")),
    locale: v.union(v.literal("en"), v.literal("id")),
    contentHash: v.string(),
    voiceId: v.string(),
    voiceSettings: v.optional(v.object({
      stability: v.optional(v.number()),
      similarityBoost: v.optional(v.number()),
      style: v.optional(v.number()),
      useSpeakerBoost: v.optional(v.boolean()),
    })),
  },
  returns: vv.id("contentAudios"),
  handler: async (ctx, args) => {
    const id = await ctx.runMutation(internal.audioStudies.mutations.upsert, args);
    
    const existing = await ctx.runQuery(internal.audioStudies.queries.get, { id });
    if (existing?.status === "completed") return id;
    if (existing?.status === "pending" || existing?.status === "generating-script" || existing?.status === "generating-speech") return id;
    
    await ctx.runAction(internal.audioStudies.actions.generateScript, { contentAudioId: id });
    await ctx.runAction(internal.audioStudies.actions.generateSpeech, { contentAudioId: id });
    
    return id;
  },
});
```

## Commands
```bash
pnpm typecheck
```
