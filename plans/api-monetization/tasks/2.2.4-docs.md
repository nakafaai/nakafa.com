# Task 2.2.3.2: Add Get API Documentation

## Goal

Document `/v1/contents/:slug` endpoint for developers following best documentation practices.

## Context

This is **Phase 2.2.3** of Build Public Content API phase.

Developers need clear documentation to understand:
- How to authenticate requests
- Request/response formats
- Error responses and how to handle them
- Rate limits and best practices

## PRD
```json
{
  "category": "documentation",
  "description": "API documentation for content get endpoint",
  "steps": [
    "Document endpoint, authentication, and URL structure",
    "Provide example requests and responses",
    "Document error responses with codes",
    "Document rate limits and headers",
    "Include best practices for content fetching"
  ],
  "passes": false
}
```

## Success Criteria

- [ ] Documentation file created
- [ ] All parameters documented
- [ ] Example request included
- [ ] Example responses included
- [ ] Error responses documented
- [ ] Rate limits documented

## Commands

```bash
# From root directory
pnpm lint
pnpm typecheck  
pnpm test
```

## Subtasks

### Subtask 2.2.3.2.1: Create Documentation File

Create comprehensive API documentation.

**File to create**: `docs/api/contents-get.md`

**Content**:

```markdown
# Get Content by Slug

## Endpoint
`GET /v1/contents/:slug`

## Description
Retrieves full content by slug. Returns both metadata and complete MDX content as a string.

## Authentication
Requires valid API key via `Authorization: Bearer <key>` header.

## URL Parameters

| Parameter | Type   | Required | Description                                           |
| --------- | ------ | -------- | ----------------------------------------------------- |
| `slug`    | string | Yes      | Content slug (e.g., `en/articles/politics/democracy`) |

## Query Parameters

| Parameter | Type   | Required | Default | Description                                        |
| --------- | ------ | -------- | ------- | -------------------------------------------------- |
| `locale`  | string | No       | `en`      | Content locale (`en` or `id`)                   |

## Rate Limits

| Tier       | Daily Limit | Minute Limit |
| ---------- | ----------- | ------------ |
| Free       | 25          | N/A          |
| Pro        | 1,000       | 100          |
| Enterprise | Unlimited   | Unlimited    |

## Example Request

```bash
curl "https://api.nakafa.com/v1/contents/en/articles/politics/democracy" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

With locale:

```bash
curl "https://api.nakafa.com/v1/contents/en/subject/mathematics/algebra?locale=id" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

## Example Response (200 OK)

### Article Content

```json
{
  "slug": "en/articles/politics/democracy",
  "url": "https://nakafa.com/en/articles/politics/democracy",
  "locale": "en",
  "type": "articles",
  "title": "Understanding Democracy",
  "description": "A comprehensive guide to democratic principles...",
  "tags": ["politics", "governance"],
  "metadata": {
    "category": "politics",
    "date": "2025-01-14T00:00:00.000Z",
    "updatedAt": "2025-01-14T00:00:00.000Z"
  },
  "content": "# Understanding Democracy\n\n## What is Democracy?\n\n<!-- Complete MDX content here -->"
}
```

### Subject Content

```json
{
  "slug": "en/subject/mathematics/algebra",
  "url": "https://nakafa.com/en/subject/mathematics/algebra",
  "locale": "en",
  "type": "subject",
  "title": "Introduction to Algebra",
  "description": "Fundamental concepts of algebra...",
  "tags": ["mathematics", "algebra", "equations"],
  "metadata": {
    "category": "mathematics",
    "grade": "10",
    "material": "algebra",
    "date": "2025-01-10T00:00:00.000Z",
    "updatedAt": "2025-01-10T00:00:00.000Z"
  },
  "content": "# Introduction to Algebra\n\n<!-- Complete MDX content here -->"
}
```

## Error Responses

### 401 Unauthorized

```json
{
  "error": "Missing or invalid API key"
}
```

### 404 Not Found

```json
{
  "error": "Content not found"
}
```

### 429 Rate Limit Exceeded

```json
{
  "error": "Rate limit exceeded",
  "retryAfter": 3600
}
```

## Response Headers

On successful requests, API includes these headers:

```
X-RateLimit-Remaining: 23
X-RateLimit-Daily-Limit: 25
X-RateLimit-Minute-Limit: 100
```

On rate limit errors:

```
Retry-After: 3600
X-RateLimit-Remaining: 0
```

## Best Practices

### Authentication

- Always include API key in `Authorization: Bearer <key>` header
- Never log or expose API keys
- Use environment variables to store keys
- Rotate keys regularly for security

### Error Handling

- Always check `error` field in response before processing data
- Use `retryAfter` header for rate limit errors to implement backoff
- Handle 404 gracefully (content may not exist)

### Performance

- Cache responses locally when possible (respect headers)
- Use conditional requests with `If-Modified-Since` header (future)
- Don't fetch same content repeatedly

### Rate Limiting

- Track `X-RateLimit-Remaining` header
- Implement exponential backoff on 429 errors
- Upgrade to higher tier if you need more quota

## Example: Error Handling in JavaScript

```javascript
async function fetchContent(slug, apiKey) {
  const response = await fetch(`/v1/contents/${slug}`, {
    headers: {
      "Authorization": `Bearer ${apiKey}`,
    },
  });

  const data = await response.json();

  if (data.error) {
    switch (response.status) {
      case 401:
        console.error("Invalid API key");
        break;
      case 404:
        console.error("Content not found:", slug);
        break;
      case 429:
        const retryAfter = response.headers.get("Retry-After");
        console.warn(`Rate limited. Retry after ${retryAfter} seconds`);
        setTimeout(() => fetchContent(slug, apiKey), retryAfter * 1000);
        break;
      default:
        console.error("Unknown error:", data.error);
    }
    return null;
  }

  return data;
}
```

## Related Endpoints

- `GET /v1/contents` - List contents with filters
- `GET /v1/contents/search` - Full-text search
- `GET /v1/contents/:slug` - Get specific content (this endpoint)

## FAQ

**Q: What format is the content field?**
A: It's a raw string containing the complete MDX content. You can render it as markdown or display it directly.

**Q: How do I determine content type from the response?**
A: Check the `type` field: `articles`, `subject`, `exercises`, or `quran`.

**Q: Why is the content returned as a string?**
A: MDX needs to be rendered by the client. Returning as string allows us to use the same content for web and API without duplication.

**Q: What happens if I exceed my rate limit?**
A: You'll receive a 429 error with a `retryAfter` timestamp. Wait until then before retrying.

**Q: Can I cache API responses?**
A: Yes, but respect the content update timestamps. Don't cache indefinitely.

**Q: How do I upgrade my API key tier?**
A: Contact support or use the API key management dashboard.
```

**Output**: Developer documentation

---

## Next Steps

After completing this task:

1. **Next task**: Task 2.3.1 - Create Search Request/Response Types

## Related Tasks

- Task 2.2.1: Create Get Content Types (interfaces documented)
- Task 2.2.2: Create Fetch Content Action (endpoint documented)
- Task 2.2.3.1: Implement Get Route Handler (handler documented)
- Task 2.1: Create Content List Endpoint (similar pattern)

## Important Notes

### DX Considerations

- Clear examples for all use cases
- Comprehensive error handling guide
- Rate limits clearly documented with headers
- FAQ covers common questions

### Documentation Best Practices

- Use consistent format across all endpoints
- Include both success and error examples
- Document response headers
- Provide working code examples
- Keep examples copy-pasteable

### Performance Considerations

- Document caching strategies
- Encourage pagination for large datasets
- Recommend using list endpoint for discovery

### Security

- Emphasize key security
- Document error handling properly
- Warn against exposing keys in client-side code
- Document rate limit backoff strategy

## Progress Tracking

After completing this task, update `plans/api-monetization/progress.txt`:

```
[YYYY-MM-DD HH:mm] Task 2.2.3.2 completed

Key decisions:
- Document both metadata and full content
- Include comprehensive error handling guide
- Provide working code examples
- Document response headers for rate limits

Files changed:
- docs/api/contents-get.md (created)

Blockers/notes:
- None. Ready for Task 2.3.
```
