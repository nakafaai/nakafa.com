# Task 4.5.4: Revocation Docs

## Goal

Document API key revocation for developers.

## Context

Developers need to understand:
See `../CONVEX_GUIDE.md` for Convex best practices (indexes, validators, helpers).

- How keys get revoked
- How to avoid revocation
- How to get unban
- Best practices

## PRD

```json
{
  "category": "documentation",
  "description": "API key revocation documentation",
  "steps": [
    "Document revocation triggers",
    "Explain unban process",
    "Provide best practices",
    "Include FAQ"
  ],
  "passes": false
}
```

## Success

- [ ] Documentation created
- [ ] Triggers documented
- [ ] Unban process documented
- [ ] FAQ included

## Commands

```bash
pnpm lint
pnpm typecheck
pnpm test
```

## Subtasks

### Subtask 4.5.4.1: Create Documentation

**File**: `docs/api/key-revocation.md`

```markdown
# API Key Revocation

## Revocation Triggers

### Automatic Triggers (Immediate Revocation)

| Trigger | Description | Severity |
|----------|-------------|----------|
| Scraping | Sequential/bulk access patterns | Critical |
| Key Sharing | Same key from 5+ IPs | Critical |
| Rate Limit Abuse | Repeated violations | Critical |

### Manual Triggers

| Trigger | Description | Severity |
|----------|-------------|----------|
| Admin Revoked | Admin manually revoked key | Info |
| User Requested | User deleted their key | Info |

## Revocation Response

When your key is revoked:

```json
{
  "success": false,
  "error": "API key revoked",
  "reason": "automated_scraping"
}
```

## Getting Unbanned

If your key was falsely revoked:

1. Contact support
2. Provide context (use case, logs)
3. Admin will investigate
4. You'll receive email if unbanned

## Best Practices

### Avoid Revocation

- Use different keys for different environments
- Implement rate limiting in your code
- Don't automate content access
- Follow tier limits strictly

### Rate Limiting

- Check `X-RateLimit-Remaining` header
- Implement exponential backoff on 429
- Upgrade tier if you need more quota

## FAQ

**Q: My key was revoked. What do I do?**
A: Contact support with details about your use case and any relevant logs.

**Q: Can I get a new key?**
A: Yes, create a new API key through the dashboard.

**Q: How do I check my usage?**
A: Use `/v1/me/usage` endpoint.

**Q: What triggers revocation?**
A: See table above.

## Monitoring

All revocations are logged with:
- Revocation reason
- Timestamp
- API key affected

Admin dashboard provides visibility into all security events.
```

**Output**: Documentation

---

## Next Steps

Phase 4 Complete.

## Related

- Task 4.5.1: Revocation Helpers (reasons documented)
- Task 4.5.2: Revoke Mutation (triggers documented)
- Task 4.5.3: Unban Mutation (process documented)

## Progress

```
[YYYY-MM-DD HH:mm] Task 4.5.4 completed

Phase 4 complete: All anti-scraping layers implemented
```
