# Task 2.1.2: Create Pagination Helper

## ğŸ¯ Goal

Create reusable pagination helper for content list endpoint following Convex best practices.

## ğŸ“ Context

This is **Phase 2.1.2** of Build Public Content API phase.

Pagination is needed for:

- Large result sets (1000s of content items)
- Bandwidth optimization (don't fetch all at once)
- Better DX (page-based navigation)
- Client-side efficiency

## PRD

```json
{
  "category": "functional",
  "description": "Pagination helper for efficient content listing",
  "steps": [
    "Calculate pagination metadata from total and limit",
    "Return correct page, limit, hasNext, hasPrevious",
    "Test edge cases (first page, last page, empty results)"
  ],
  "passes": false
}
```

## ğŸ¬ Success Criteria

- [ ] `calculatePagination()` helper function created
- [ ] Returns correct pagination metadata
- [ ] Handles edge cases (empty results, single page, last page)
- [ ] Unit tests for all scenarios
- [ ] Used in content list endpoint

## Commands

```bash
# From root directory
pnpm lint
pnpm typecheck  
pnpm test
```

## ğŸ“ Subtasks

### Subtask 2.1.2.1: Create Pagination Helper Function

Create reusable pagination calculation function.

**File to create**: `packages/backend/convex/routes/v1/contents/list/pagination.ts`

**Implementation**:

```typescript
export interface PaginationMetadata {
  page: number;
  limit: number;
  total: number;
  totalPages: number;
  hasNext: boolean;
  hasPrevious: boolean;
}

/**
 * Calculates pagination metadata.
 * Pure function (no side effects, testable without Convex).
 *
 * @param page - Current page number (1-indexed)
 * @param limit - Items per page
 * @param total - Total number of items
 * @returns Pagination metadata
 */
export function calculatePagination(
  page: number,
  limit: number,
  total: number
): PaginationMetadata {
  const totalPages = Math.ceil(total / limit);

  return {
    page,
    limit,
    total,
    totalPages,
    hasNext: page < totalPages,
    hasPrevious: page > 1,
  };
}
```

**Features**:

- Pure function (testable without Convex)
- 1-indexed pages (natural for humans)
- Handles edge cases (empty results, single page)

**Output**: Pagination helper function

---

### Subtask 2.1.2.2: Add Unit Tests

Test pagination function for all scenarios.

**Test File**: `packages/backend/convex/routes/v1/contents/list/__tests__/pagination.test.ts`

**Test Cases**:

```typescript
import { describe, it, expect } from "vitest";
import { calculatePagination } from "../pagination";

describe("calculatePagination", () => {
  describe("normal cases", () => {
    it("should calculate correct pagination for page 1 of 10", () => {
      const result = calculatePagination(1, 10, 100);

      expect(result.page).toBe(1);
      expect(result.limit).toBe(10);
      expect(result.total).toBe(100);
      expect(result.totalPages).toBe(10);
      expect(result.hasNext).toBe(true);
      expect(result.hasPrevious).toBe(false);
    });

    it("should calculate correct pagination for page 5 of 10", () => {
      const result = calculatePagination(5, 10, 100);

      expect(result.page).toBe(5);
      expect(result.totalPages).toBe(10);
      expect(result.hasNext).toBe(true);
      expect(result.hasPrevious).toBe(true);
    });

    it("should calculate correct pagination for last page", () => {
      const result = calculatePagination(10, 10, 100);

      expect(result.page).toBe(10);
      expect(result.totalPages).toBe(10);
      expect(result.hasNext).toBe(false);
      expect(result.hasPrevious).toBe(true);
    });
  });

  describe("edge cases", () => {
    it("should handle single page", () => {
      const result = calculatePagination(1, 10, 10);

      expect(result.page).toBe(1);
      expect(result.totalPages).toBe(1);
      expect(result.hasNext).toBe(false);
      expect(result.hasPrevious).toBe(false);
    });

    it("should handle empty results", () => {
      const result = calculatePagination(1, 10, 0);

      expect(result.page).toBe(1);
      expect(result.total).toBe(0);
      expect(result.totalPages).toBe(0);
      expect(result.hasNext).toBe(false);
      expect(result.hasPrevious).toBe(false);
    });

    it("should handle partial last page", () => {
      const result = calculatePagination(10, 10, 95);

      expect(result.page).toBe(10);
      expect(result.totalPages).toBe(10);
      expect(result.hasNext).toBe(false);
      expect(result.hasPrevious).toBe(true);
    });
  });
});
```

**Coverage**:

- Normal cases (middle pages, first page, last page)
- Edge cases (single page, empty results, partial page)
- Boolean flags (hasNext, hasPrevious)

**Output**: Comprehensive test coverage

---

## ğŸš€ Next Steps

After completing this task:

1. **Next task**: Task 2.1.3 - Implement Route Handler

## ğŸ”— Related Tasks

- Task 2.1.1: Create Content List Types and Helpers (uses this pagination)
- Task 2.1.3: Implement Route Handler (uses this pagination)

## âš ï¸ Important Notes

### DX Considerations

- Pure function: Easy to test in isolation
- No side effects: Always returns same result for same inputs
- Type-safe: TypeScript interface for metadata
- Well-documented: Clear parameter descriptions

### Edge Cases Handled

- Empty results: All booleans false, total 0
- Single page: All booleans false, totalPages 1
- Last page: hasNext false, hasPrevious true
- Partial page: hasNext false, hasPrevious true

### Performance

- O(1) calculation (simple math)
- No database queries (runs in client code)
- No expensive operations

## Progress Tracking

After completing this task, update `plans/api-monetization/progress.txt`:

```txt
[YYYY-MM-DD HH:mm] Task 2.1.2 completed

Key decisions:
- Use pure function for pagination (no Convex dependencies)
- Keep it testable in isolation
- Handle all edge cases explicitly

Files changed:
- packages/backend/convex/routes/v1/contents/list/pagination.ts (created)
- packages/backend/convex/routes/v1/contents/list/__tests__/pagination.test.ts (created)

Blockers/notes:
- None. Ready for Task 2.1.3.
```
