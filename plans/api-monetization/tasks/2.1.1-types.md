# Task 2.1.1: Create Content List Types and Helpers

## ğŸ¯ Goal

Create TypeScript interfaces and helper functions for content list endpoint following Convex best practices.

## ğŸ“ Context

This is **Phase 2.1.1** of Build Public Content API phase.

Developers need type-safe interfaces for request/response and helper functions for:

- Building content slugs from filters
- Detecting content type from slug
- Pagination logic

## PRD

```json
{
  "category": "functional",
  "description": "Type-safe interfaces and helper functions for content list endpoint",
  "steps": [
    "Create ListContentsQuery interface",
    "Create ListContentsResponse interface",
    "Create ContentMetadata interface",
    "Add buildContentSlug helper function",
    "Add detectContentType helper function",
    "Verify types export correctly"
  ],
  "passes": false
}
```

## ğŸ¬ Success Criteria

- [ ] `ListContentsQuery` interface created
- [ ] `ListContentsResponse` interface created
- [ ] `ContentMetadata` interface created
- [ ] `buildContentSlug()` helper function works
- [ ] `detectContentType()` helper function works
- [ ] All types export correctly

## Commands

```bash
# From root directory
pnpm lint
pnpm typecheck  
pnpm test
```

## ğŸ“ Subtasks

### Subtask 2.1.1.1: Create Request/Response Interfaces

Create TypeScript interfaces for type safety.

**File to create**: `packages/backend/convex/routes/v1/contents/list/types.ts`

**Implementation**:

```typescript
export interface ListContentsQuery {
  locale?: "en" | "id";
  type?: "articles" | "subject" | "exercises";
  category?: string;
  grade?: string;
  material?: string;
  page?: number;
  limit?: number;
}

export interface ListContentsResponse {
  contents: ContentMetadata[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
    hasNext: boolean;
    hasPrevious: boolean;
  };
}

export interface ContentMetadata {
  slug: string;
  url: string;
  locale: string;
  type: "articles" | "subject" | "exercises";
  title: string;
  description: string;
  tags: string[];
  category?: string;
  grade?: string;
  material?: string;
  createdAt: number;
  updatedAt: number;
}
```

**Output**: Type-safe interfaces

---

### Subtask 2.1.1.2: Create Helper Functions

Create utility functions for slug building and type detection.

**File to create**: `packages/backend/convex/routes/v1/contents/list/utils.ts`

**Implementation**:

```typescript
/**
 * Builds content slug from locale and filters.
 * Helper function used in list endpoint.
 */
export function buildContentSlug(params: {
  locale: string;
  filters: { type?: string; category?: string; grade?: string; material?: string };
}): string {
  const { locale, filters } = params;
  const parts = [locale];

  if (filters.type) {
    parts.push(filters.type);
  }
  if (filters.category) {
    parts.push(filters.category);
  }
  if (filters.grade) {
    parts.push(filters.grade);
  }
  if (filters.material) {
    parts.push(filters.material);
  }

  return parts.join("/");
}

/**
 * Detects content type from slug.
 * Helper function used across endpoints.
 */
export function detectContentType(slug: string): "articles" | "subject" | "exercises" {
  if (slug.startsWith("articles")) return "articles";
  if (slug.startsWith("subject")) return "subject";
  if (slug.startsWith("exercises")) return "exercises";
  return "subject";
}

/**
 * Extracts category from slug.
 * Helper function for metadata generation.
 */
export function extractCategory(slug: string): string | undefined {
  const parts = slug.split("/");
  if (parts.length > 1 && parts[0] !== "en" && parts[0] !== "id") {
    return parts[1];
  }
  return undefined;
}

/**
 * Extracts grade from slug.
 * Helper function for metadata generation.
 */
export function extractGrade(slug: string): string | undefined {
  const parts = slug.split("/");
  for (const part of parts) {
    if (part.match(/^(\d{1,2})$/)) {
      return part;
    }
  }
  return undefined;
}

/**
 * Extracts material from slug.
 * Helper function for metadata generation.
 */
export function extractMaterial(slug: string): string | undefined {
  const parts = slug.split("/");
  for (const part of parts) {
    if (part.match(/^(algebra|geometry|calculus|statistics|probability|trigonometry)$/i)) {
      return part;
    }
  }
  return undefined;
}
```

**Features**:

- Pure functions (no side effects)
- Reusable across endpoints
- Type-safe
- Well-tested

**Output**: Helper functions created

---

## ğŸš€ Next Steps

After completing this task:

1. **Next task**: Task 2.1.2 - Create Pagination Helper

## ğŸ”— Related Tasks

- Task 2.1.2: Create Pagination Helper (uses these helpers)
- Task 2.1.3: Implement Route Handler (uses these types and helpers)
- Task 2.2.1: Get Content Metadata (uses helpers from this task)

## âš ï¸ Important Notes

### DX Considerations

- Pure TypeScript functions: Easy to test in isolation
- No database calls: Can unit test without Convex
- Reusable: Same helpers used in get/search endpoints

### Type Safety

- Strict interfaces prevent runtime errors
- Export all public types from single file
- Use in other tasks via `@repo/backend/convex/routes/v1/contents/list/types`

### Future Enhancements

- Consider adding validateQuery() function to validate inputs
- Consider adding normalizeFilters() function to standardize inputs

## Progress Tracking

After completing this task, update `plans/api-monetization/progress.txt`:

```txt
[YYYY-MM-DD HH:mm] Task 2.1.1 completed

Key decisions:
- Use pure functions for helpers (no Convex calls)
- Export types and helpers from same directory
- Keep helpers simple and testable

Files changed:
- packages/backend/convex/routes/v1/contents/list/types.ts (created)
- packages/backend/convex/routes/v1/contents/list/utils.ts (created)

Blockers/notes:
- None. Ready for Task 2.1.2.
```
