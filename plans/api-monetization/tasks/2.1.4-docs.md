# Task 2.1.4: Add API Documentation

## üéØ Goal

Document `/v1/contents` endpoint for developers following best documentation practices.

## üìç Context

This is **Phase 2.1.4** of Build Public Content API phase.

Developers need clear documentation to understand how to use the content list endpoint effectively.

## PRD

```json
{
  "category": "documentation",
  "description": "API documentation for /v1/contents endpoint",
  "steps": [
    "Document endpoint, authentication, and query parameters",
    "Provide example requests and responses",
    "Document rate limits and error responses",
    "Include best practices for pagination and error handling"
  ],
  "passes": false
}
```

## üé¨ Success Criteria

- [ ] Documentation file created
- [ ] All query parameters documented
- [ ] Example request included
- [ ] Example response included
- [ ] Rate limits documented
- [ ] Error responses documented

## Commands

```bash
# From root directory
pnpm lint
pnpm typecheck
pnpm test
```

## üìù Subtasks

### Subtask 2.1.4.1: Create Documentation File

Create comprehensive API documentation for the content list endpoint.

**File to create**: `docs/api/contents-list.md`

**Content**:

```markdown
# List Contents

## Endpoint
`GET /v1/contents`

## Description
Retrieves a paginated list of content items with optional filters. Returns **metadata only**, not full content.

## Authentication
Requires valid API key via `Authorization: Bearer <key>` header.

## Query Parameters

| Parameter  | Type    | Required | Default                                                         | Description |
| ---------- | ------- | -------- | --------------------------------------------------------------- | ----------- |
| `locale`   | string  | No       | `en` or `id`. Content locale. Default: `en`                     |
| `type`     | string  | No       | Content type filter. Values: `articles`, `subject`, `exercises` |
| `category` | string  | No       | Category filter (e.g., `politics`, `mathematics`)               |
| `grade`    | string  | No       | Grade filter (e.g., `10`, `11`, `12`)                           |
| `material` | string  | No       | Material filter (e.g., `algebra`, `geometry`)                   |
| `page`     | integer | No       | Page number (1-indexed). Default: `1`                           |
| `limit`    | integer | No       | Items per page. Default: `20`, Max: `100`                       |

## Rate Limits

| Tier       | Daily Limit | Minute Limit |
| ---------- | ----------- | ------------ |
| Free       | 25          | N/A          |
| Pro        | 1,000       | 100          |
| Enterprise | Unlimited   | Unlimited    |

## Example Request

```bash
curl "https://api.nakafa.com/v1/contents?type=articles&locale=en&page=1&limit=20" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

## Example Response

```json
{
  "contents": [
    {
      "slug": "en/articles/politics/democracy",
      "url": "https://nakafa.com/en/articles/politics/democracy",
      "locale": "en",
      "type": "articles",
      "title": "Understanding Democracy",
      "description": "A comprehensive guide to democratic principles...",
      "tags": ["politics", "governance"],
      "category": "politics",
      "grade": null,
      "material": null,
      "createdAt": 1705228800000,
      "updatedAt": 1705228800000
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 150,
    "totalPages": 8,
    "hasNext": true,
    "hasPrevious": false
  }
}
```

## Error Responses

### 401 Unauthorized

```json
{
  "error": "Missing or invalid API key"
}
```

### 429 Rate Limit Exceeded

```json
{
  "error": "Rate limit exceeded",
  "retryAfter": 3600
}
```

## Best Practices

### Pagination

- Use `hasNext` boolean to determine if you should fetch more
- Store `total` to calculate total pages
- Always respect the `limit` parameter

### Error Handling

- Check `error` field in response before processing data
- Use `retryAfter` for rate limit errors to implement backoff
- Handle 401 by refreshing API key

### Performance

- Request only needed fields by using filters
- Use smaller `limit` for initial loads, then paginate
- Cache responses locally when possible

## Example: Implementing Pagination in JavaScript

```javascript
async function fetchAllContents(apiKey) {
  let allContents = [];
  let page = 1;
  const limit = 100;
  let hasNext = true;

  while (hasNext) {
    const response = await fetch(`/v1/contents?page=${page}&limit=${limit}`, {
      headers: { "Authorization": `Bearer ${apiKey}` }
    });

    if (!response.ok) {
      throw new Error(`Failed to fetch page ${page}`);
    }

    const data = await response.json();
    allContents = allContents.concat(data.contents);
    hasNext = data.pagination.hasNext;
    page++;
  }

  return allContents;
}
```

**Output**: Developer documentation

---

## üöÄ Next Steps

After completing this task:

1. **Next task**: Task 2.2 - Create Content Get Endpoint
2. **Phase 2**: Continue building public API

## üîó Related Tasks

- Task 2.1.1: Create Content List Types and Helpers (interfaces documented)
- Task 2.1.2: Create Pagination Helper (pagination logic documented)
- Task 2.1.3: Implement Route Handler (endpoint documented)
- Task 2.4: Implement Tiered Rate Limiting (rate limits referenced)

## ‚ö†Ô∏è Important Notes

### DX Considerations

- **Fast discovery**: Metadata-only responses are small and fast
- **Intuitive pagination**: `page` parameter is 1-indexed (natural for humans)
- **Clear filtering**: Query params match content structure (type, category, grade, material)
- **Code examples**: JavaScript examples for common use cases

### Rate Limiting

- **Free tier**: 25/day is for indie developers (as requested)
- **Pro tier**: 100/min prevents API abuse while allowing flexibility
- **Enterprise**: Unlimited but monitored via `contentAccessLog`

### Security

- All access logged for scraping detection
- Rate limits prevent bulk downloads
- API key validation happens before any content access

### Future Enhancements

- Consider adding `search` parameter for fuzzy search
- Consider adding `sort` parameter (date, popularity, alphabetical)
- Consider adding `fields` parameter (request only specific metadata fields)

## Progress Tracking

After completing this task, update `plans/api-monetization/progress.txt`:

```text
[YYYY-MM-DD HH:mm] Task 2.1.4 completed

Key decisions:
- Document all query parameters with types and defaults
- Provide working curl example
- Include rate limits table for all tiers
- Add JavaScript example for pagination
- Document error responses with codes

Files changed:
- docs/api/contents-list.md (created)

Blockers/notes:
- None. Ready for Task 2.2.
```
