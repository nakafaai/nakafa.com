# Task 2.2.1: Create Content Get Types

## üéØ Goal

Create TypeScript interfaces for content get endpoint following Convex best practices.

## üìç Context

This is **Phase 2.2.1** of Build Public Content API phase.

Content get endpoint needs type-safe interfaces for:
- Request parameters (slug, locale)
- Response format (metadata + full content)
- Content structure validation

## PRD
```json
{
  "category": "architecture",
  "description": "Type-safe interfaces for content get endpoint",
  "steps": [
    "Create GetContentRequest interface",
    "Create GetContentResponse interface",
    "Create FullContent interface",
    "Define content variants (article, subject, exercise, quran)",
    "Verify types export correctly"
  ],
  "passes": false
}
```

## üé¨ Success Criteria

- [ ] `GetContentRequest` interface created
- [ ] `GetContentResponse` interface created
- [ ] `FullContent` interface created
- [ ] All content variants defined
- [ ] Types export correctly

## Commands

```bash
# From root directory
pnpm lint
pnpm typecheck  
pnpm test
```

## üìù Subtasks

### Subtask 2.2.1.1: Create Request/Response Interfaces

Create TypeScript interfaces for type safety.

**File to create**: `packages/backend/convex/routes/v1/contents/get/types.ts`

**Implementation**:

```typescript
export interface GetContentRequest {
  slug: string;
  locale?: "en" | "id";
}

export interface GetContentResponse {
  slug: string;
  url: string;
  locale: string;
  type: "articles" | "subject" | "exercises" | "quran";
  title: string;
  description: string;
  tags: string[];
  metadata: {
    category?: string;
    grade?: string;
    material?: string;
    date?: number;
    updatedAt?: number;
  };
  content: string; // Full MDX content as string
}

export interface FullContent {
  slug: string;
  url: string;
  locale: string;
  type: "articles" | "subject" | "exercises" | "quran";
  title: string;
  description: string;
  tags: string[];
  metadata: {
    category?: string;
    grade?: string;
    material?: string;
    date?: number;
    updatedAt?: number;
  };
  raw: string; // Full MDX content
}
```

**Why Separate Interfaces?**

- Request/Response: API contract definition
- FullContent: Internal data structure
- Reusable: Can be used across endpoints

**Output**: Type-safe interfaces

---

### Subtask 2.2.1.2: Create Content Validation Helpers

Create helper functions for content type detection and slug validation.

**File to create**: `packages/backend/convex/routes/v1/contents/get/utils.ts`

**Implementation**:

```typescript
/**
 * Detects content type from slug.
 * Reuses logic from Task 2.1.1.
 */
export function detectContentGetType(slug: string): "articles" | "subject" | "exercises" | "quran" {
  if (slug.startsWith("articles")) return "articles";
  if (slug.startsWith("subject")) return "subject";
  if (slug.startsWith("exercises")) return "exercises";
  if (slug.startsWith("quran")) return "quran";
  return "subject";
}

/**
 * Validates content slug format.
 * Ensures slug follows expected structure.
 */
export function validateContentSlug(slug: string): { valid: boolean; error?: string } {
  if (!slug || slug.length === 0) {
    return { valid: false, error: "Slug is required" };
  }

  const parts = slug.split("/");
  if (parts.length < 2) {
    return { valid: false, error: "Slug must have at least 2 parts" };
  }

  const type = detectContentGetType(parts[0]);
  if (!["articles", "subject", "exercises", "quran"].includes(type)) {
    return { valid: false, error: `Invalid content type: ${type}` };
  }

  return { valid: true };
}
```

**Output**: Validation helpers

---

## üöÄ Next Steps

After completing this task:

1. **Next task**: Task 2.2.2 - Create Fetch Content Action

## üîó Related Tasks

- Task 2.1.1: Create Content List Types (similar pattern)
- Task 2.2.2: Create Fetch Content Action (uses these types)
- Task 2.2.3: Implement Route Handler (uses these types)

## ‚ö†Ô∏è Important Notes

### DX Considerations

- Type-safe interfaces prevent runtime errors
- Reusable helpers reduce code duplication
- Clear error messages help developers

### Type Safety

- All request parameters typed
- All response fields typed
- Content variants explicit (no `any` types)

### Future Enhancements

- Consider adding Zod schemas for runtime validation
- Consider adding OpenAPI spec generation from types
- Consider adding TypeScript strict mode compliance

## Progress Tracking

After completing this task, update `plans/api-monetization/progress.txt`:

```text
[YYYY-MM-DD HH:mm] Task 2.2.1 completed

Key decisions:
- Separate interfaces for request/response vs internal data
- Reuse detectContentGetType from Task 2.1.1
- Add validateContentSlug helper for input validation

Files changed:
- packages/backend/convex/routes/v1/contents/get/types.ts (created)
- packages/backend/convex/routes/v1/contents/get/utils.ts (created)

Blockers/notes:
- None. Ready for Task 2.2.2.
```
