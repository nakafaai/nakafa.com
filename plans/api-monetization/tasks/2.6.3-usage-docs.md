# Task 2.6.3: Usage Docs

## Goal

Document usage endpoint for developers.

## Context

Users need to understand:
See `../CONVEX_GUIDE.md` for Convex best practices (indexes, validators, helpers).

- How to fetch usage
- What data is returned
- How to calculate remaining quota

## PRD

```json
{
  "category": "documentation",
  "description": "Usage endpoint documentation",
  "steps": [
    "Document endpoints and parameters",
    "Provide examples",
    "Explain rate limits",
    "Add FAQ"
  ],
  "passes": false
}
```

## Success

- [ ] Documentation created
- [ ] Examples included
- [ ] Rate limits explained
- [ ] FAQ added

## Commands

```bash
pnpm lint
pnpm typecheck
pnpm test
```

## Subtasks

### Subtask 2.6.3.1: Create Documentation

**File**: `docs/api/usage.md`

**Content**:

```markdown
# API Usage

## Endpoints

### Get Single Key Usage

`GET /v1/me/usage`

Returns usage statistics for current API key.

### Get All Keys Usage

`GET /v1/me/usage/all`

Returns usage for all user's API keys.

## Authentication

Requires valid API key via `Authorization: Bearer <key>` header.

## Rate Limits

| Tier | Daily | Minute |
|-------|-------|--------|
| Free | 25 | N/A |
| Pro | 1000 | 100 |
| Enterprise | Unlimited | Unlimited |

## Example: Get Usage

```bash
curl "https://api.nakafa.com/v1/me/usage" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

**Response**:

```json
{
  "apiKeyId": "abc123...",
  "subscriptionTier": "pro",
  "requestsToday": 42,
  "requestsThisMinute": 7,
  "dailyLimit": 1000,
  "minuteLimit": 100,
  "dailyResetTime": 1705228800000,
  "minuteResetTime": 1705228860000,
  "remainingToday": 958,
  "remainingMinute": 93,
  "lastRequestTime": 1705228800000
}
```

## Example: Get All Usage

```bash
curl "https://api.nakafa.com/v1/me/usage/all" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

**Response**:

```json
{
  "apiKeys": [
    {
      "id": "abc123...",
      "name": "Production",
      "subscriptionTier": "pro",
      "usage": {
        "requestsToday": 42,
        "remainingToday": 958
      }
    }
  ],
  "total": 1
}
```

## FAQ

**Q: How do I know if I'm rate limited?**
A: Check remainingToday/remainingMinute fields. If 0, you're at limit.

**Q: When do limits reset?**
A: dailyResetTime (midnight UTC), minuteResetTime (on the minute).

**Q: Can I exceed limits temporarily?**
A: No, you'll get 429 error if you exceed.

**Q: How do I increase my limits?**
A: Upgrade to higher tier via dashboard or contact support.
```

**Output**: Documentation

---

## Next Steps

Phase 2 Complete.

## Related

- Task 2.4.1: Rate Limit Model (data structure documented)
- Task 2.6.2: Usage Route (endpoint documented)

## Progress

```
[YYYY-MM-DD HH:mm] Task 2.6.3 completed

Key decisions:
- Single and all keys endpoints
- Clear remaining quota calculation
- FAQ for common questions

Files changed:
- docs/api/usage.md

Blockers: None
```

**Phase 2 Status**: Complete
```
[YYYY-MM-DD HH:mm] Phase 2 complete

All tasks completed:
- Task 2.1: Content List (4 subtasks)
- Task 2.2: Content Get (4 subtasks)
- Task 2.3: Content Search (4 subtasks)
- Task 2.4: Rate Limiting (5 subtasks)
- Task 2.5: API Key Management (5 subtasks)
- Task 2.6: Usage Dashboard (3 subtasks)

Total: 25 subtasks across 6 tasks
All files follow Convex best practices
All files use concise naming
```
