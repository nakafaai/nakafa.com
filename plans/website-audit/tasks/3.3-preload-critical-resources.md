# Task 2.3: Preload Critical Resources

## üéØ Goal

Preload critical resources (logo, hero images) to improve LCP (Largest Contentful Paint) and overall page load performance.

## üìç Context

**Current Issues**:
- Logo.svg not preloaded
- Stars.png (hero background) not preloaded
- LCP images lack `fetchpriority="high"`
- Some above-fold images use `loading="lazy"`

**Impact**:
- LCP currently >2.5s on mobile
- Logo appears after initial paint
- Hero content shifts as images load

**Why This Matters**:
- LCP is a Core Web Vital (should be <2.5s)
- Google ranking factor
- First impression for users
- Affects perceived performance

## PRD

```json
{
  "category": "performance",
  "description": "Preload critical resources and optimize LCP image loading",
  "steps": [
    "Add preload link for logo.svg",
    "Add preload link for critical CSS",
    "Add fetchpriority='high' to LCP images",
    "Remove loading='lazy' from above-fold images",
    "Test LCP improvement",
    "Verify no console warnings"
  ],
  "passes": false
}
```

## üé¨ Success Criteria

- [ ] LCP < 2.5s on mobile
- [ ] Logo preloaded and appears before first paint
- [ ] Hero images load with high priority
- [ ] No render-blocking warnings in Lighthouse
- [ ] All tests pass

## Commands

```bash
# From root directory
pnpm lint
pnpm typecheck
pnpm test
```

## üìù Implementation

### Step 1: Add Preload Links to Layout

**File to modify**: `apps/www/app/[locale]/layout.tsx`

Add preload links in the head:

```typescript
<html className={fonts} lang={locale} suppressHydrationWarning>
  <head>
    {/* Preload critical resources */}
    <link
      rel="preload"
      href="/logo.svg"
      as="image"
      type="image/svg+xml"
    />
    <link
      rel="preload"
      href="/_next/image?url=%2Fstars.png&w=3840&q=75"
      as="image"
      type="image/webp"
      imagesrcset="/_next/image?url=%2Fstars.png&w=640&q=75 640w, /_next/image?url=%2Fstars.png&w=750&q=75 750w, /_next/image?url=%2Fstars.png&w=828&q=75 828w, /_next/image?url=%2Fstars.png&w=1080&q=75 1080w, /_next/image?url=%2Fstars.png&w=1200&q=75 1200w, /_next/image?url=%2Fstars.png&w=1920&q=75 1920w, /_next/image?url=%2Fstars.png&w=2048&q=75 2048w, /_next/image?url=%2Fstars.png&w=3840&q=75 3840w"
      imagesizes="100vw"
    />
    
    <ReactScan />
    <EducationalOrgJsonLd />
    <OrganizationJsonLd />
    <WebsiteJsonLd locale={locale} />
  </head>
```

### Step 2: Optimize Hero Image Component

**File to modify**: Hero image components (find where stars.png is used)

Add fetchpriority:

```typescript
import Image from "next/image";

// In your hero component
<Image
  src="/stars.png"
  alt="Background stars"
  fill
  priority // This adds fetchpriority="high" and disables lazy loading
  sizes="100vw"
  className="object-cover"
/>
```

### Step 3: Optimize Logo Component

**File to modify**: Logo component

```typescript
import Image from "next/image";

// Logo should use priority for above-fold placement
<Image
  src="/logo.svg"
  alt="Nakafa Logo"
  width={120}
  height={40}
  priority // Prevents lazy loading
/>
```

### Step 4: Remove Lazy Loading from Above-Fold Images

**Audit all Image components** and remove `loading="lazy"` from:
- Logo
- Hero images
- Main content images in viewport
- Author avatars (if visible immediately)

**Before**:
```typescript
<Image
  src="/hero.jpg"
  alt="Hero"
  loading="lazy" // ‚ùå Remove this
/>
```

**After**:
```typescript
<Image
  src="/hero.jpg"
  alt="Hero"
  priority // ‚úÖ Add this for above-fold
/>
```

---

## üöÄ Next Steps

After this task:
- Next: Task 3.1 - Article Structured Data
- Dependencies: None

## üîó Related Tasks

- Task 2.1: Optimize TTFB (performance)
- Task 2.2: Reduce DOM Size (performance)

## ‚ö†Ô∏è Important Notes

### What to Preload

Only preload critical above-fold resources:
- ‚úÖ Logo
- ‚úÖ Hero images
- ‚úÖ Critical fonts (if not using next/font)
- ‚úÖ Main CSS (if render-blocking)

Don't preload:
- ‚ùå Below-fold images
- ‚ùå Non-critical scripts
- ‚ùå Large videos
- ‚ùå Analytics scripts

### Priority vs Preload

- **preload link**: Tells browser to download early
- **priority prop on Image**: Sets fetchpriority="high" + disables lazy loading

Use both for best results on critical images.

### Testing LCP

```bash
# Using Lighthouse CLI
npx lighthouse https://nakafa.com --only-categories=performance

# Or in Chrome DevTools:
# 1. Open Performance tab
# 2. Check "Web Vitals" checkbox
# 3. Record and look for LCP marker
```

### Common Issues

**Warning: The resource was preloaded using link preload but not used**:
- Ensure preloaded URL exactly matches used URL
- Check for query parameters
- Verify the resource is actually rendered

---

## Progress Update Template

After completing this task, update `plans/website-audit/progress.txt`:

```txt
[YYYY-MM-DD HH:mm] Task 2.3 completed - Preload Critical Resources

Key decisions:
- Added preload links for logo.svg and hero background
- Added priority prop to all above-fold images
- Removed loading="lazy" from 12 above-fold images
- Optimized Image component usage throughout

Files modified:
- apps/www/app/[locale]/layout.tsx (added preload links)
- [List hero component files]
- [List logo component files]
- [List other image components]

Performance improvements:
- LCP: 3.2s ‚Üí 1.8s (44% improvement)
- Logo now appears before first paint
- No render-blocking warnings in Lighthouse
- Lighthouse Performance: +3 points

Blockers/notes:
- None
- Verified all preloaded resources are actually used
- No console warnings
```
