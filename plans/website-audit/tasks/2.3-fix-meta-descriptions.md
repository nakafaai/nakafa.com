# Task 2.3: Fix Meta Descriptions (124 Pages)

## üéØ Goal

Fix meta description issues on 124 pages to improve Core SEO score and click-through rates.

## üìç Context

**Current State**: 
- 124 pages with meta description issues
- Descriptions too short (3-26 chars): Quran pages
- Descriptions too long (161-171 chars): Some content pages

**Issues Found**:
1. **Too short**: Quran pages use only surah translation (e.g., "The Opener" - 11 chars)
2. **Too long**: Some content pages exceed 160 character limit
3. **Missing value proposition**: Descriptions don't entice clicks

**Why This Matters**:
- Meta descriptions appear in Google SERP under title
- 150-160 chars is optimal for display
- Compelling descriptions improve CTR by 5-30%
- Should include primary keyword naturally

## PRD

```json
{
  "category": "seo",
  "description": "Fix meta descriptions on 124 pages to be 120-160 characters with clear value proposition",
  "steps": [
    "Identify all pages with description issues",
    "Expand short descriptions to 120+ characters",
    "Truncate long descriptions to 160 characters",
    "Add clear value proposition to each description",
    "Include primary keyword naturally",
    "Add call-to-action where appropriate",
    "Verify uniqueness across all pages"
  ],
  "passes": false
}
```

## üé¨ Success Criteria

- [ ] All descriptions 120-160 characters
- [ ] No duplicate descriptions
- [ ] Each description has clear value proposition
- [ ] Primary keyword included naturally
- [ ] Call-to-action on key pages
- [ ] Quran pages have contextual descriptions
- [ ] Core SEO score > 90/100
- [ ] All tests pass

## Commands

```bash
# From root directory
pnpm lint
pnpm typecheck
pnpm test

# Audit to verify fixes
squirrel audit https://nakafa.com --max-pages 100 --format llm
```

## üìù Implementation

### Step 1: Analyze Current Description Issues

**Quran pages** (from earlier analysis):
```typescript
const description = surahData.name.translation[locale];
// Result: "The Opener" (11 chars) - TOO SHORT
```

**Content pages**:
- Check if using content excerpt (may be too long or too short)
- Check if using generic fallback descriptions

### Step 2: Fix Quran Page Descriptions

**File**: `apps/www/app/[locale]/(study)/(main)/(contents)/quran/[surah]/page.tsx`

**Current code**:
```typescript
const description = surahData.name.translation[locale];

return {
  // ...
  description,
  // ...
};
```

**Fixed code**:
```typescript
const surahName = getSurahName({ locale, name: surahData.name });
const surahTranslation = surahData.name.translation[locale];
const surahNumber = surahData.number;
const verseCount = surahData.numberOfVerses;
const revelationType = surahData.revelationType;

// Create rich description: "Surah Al-Fatihah (The Opener) is the 1st chapter of the Quran with 7 verses. A Meccan surah about guidance and worship."
const description = `Surah ${surahName} (${surahTranslation}) is the ${surahNumber}${getOrdinalSuffix(surahNumber)} chapter of the Quran with ${verseCount} verses. A ${revelationType.toLowerCase()} surah.`;

return {
  // ...
  description,
  // ...
};
```

**Helper function**:
```typescript
function getOrdinalSuffix(n: number): string {
  const s = ["th", "st", "nd", "rd"];
  const v = n % 100;
  return s[(v - 20) % 10] || s[v] || s[0];
}
```

**Example improvements**:
- Before: "The Opener" (11 chars)
- After: "Surah Al-Fatihah (The Opener) is the 1st chapter of the Quran with 7 verses. A meccan surah." (95 chars)

### Step 3: Create Description Utility Function

**New file**: `apps/www/lib/utils/seo/descriptions.ts`

```typescript
import type { Locale } from "next-intl";

const MIN_DESCRIPTION_LENGTH = 120;
const MAX_DESCRIPTION_LENGTH = 160;

/**
 * Validate and fix description length
 */
export function validateDescription(description: string): string {
  // If too short, return as-is (caller should expand)
  if (description.length < MIN_DESCRIPTION_LENGTH) {
    return description;
  }
  
  // If too long, truncate intelligently
  if (description.length > MAX_DESCRIPTION_LENGTH) {
    // Try to truncate at sentence boundary
    const truncated = description.slice(0, MAX_DESCRIPTION_LENGTH);
    const lastPeriod = truncated.lastIndexOf(".");
    const lastSpace = truncated.lastIndexOf(" ");
    
    if (lastPeriod > MAX_DESCRIPTION_LENGTH - 20) {
      return truncated.slice(0, lastPeriod + 1);
    }
    
    return truncated.slice(0, lastSpace) + "...";
  }
  
  return description;
}

/**
 * Create description for Quran surah pages
 */
export function createQuranDescription(
  surahName: string,
  surahTranslation: string,
  surahNumber: number,
  verseCount: number,
  revelationType: string
): string {
  const baseDescription = `Surah ${surahName} (${surahTranslation}) is the ${surahNumber}${getOrdinalSuffix(surahNumber)} chapter of the Quran with ${verseCount} verses. A ${revelationType.toLowerCase()} surah.`;
  
  // Add context if space permits
  if (baseDescription.length < 140) {
    return `${baseDescription} Read the full text, translation, and interpretation.`;
  }
  
  return baseDescription;
}

/**
 * Create description for subject content pages
 */
export function createSubjectDescription(
  contentTitle: string,
  contentDescription: string,
  subject: string,
  grade: number
): string {
  const baseDescription = `Learn about ${contentTitle} in ${subject} for Grade ${grade}. ${contentDescription}`;
  
  return validateDescription(baseDescription);
}

/**
 * Create description for article pages
 */
export function createArticleDescription(
  articleTitle: string,
  articleExcerpt: string,
  category: string
): string {
  const baseDescription = `${articleTitle}. ${articleExcerpt} Read this ${category} article and more educational content.`;
  
  return validateDescription(baseDescription);
}

/**
 * Create description for exercise pages
 */
export function createExerciseDescription(
  exerciseTitle: string,
  subject: string,
  difficulty: string
): string {
  return `Practice ${exerciseTitle} with interactive exercises. ${subject} problems for ${difficulty} level. Test your knowledge and track your progress.`;
}

function getOrdinalSuffix(n: number): string {
  const s = ["th", "st", "nd", "rd"];
  const v = n % 100;
  return s[(v - 20) % 10] || s[v] || s[0];
}
```

### Step 4: Fix Subject Content Descriptions

**File**: `apps/www/app/[locale]/(study)/(main)/(contents)/subject/[category]/[grade]/[material]/[...slug]/page.tsx`

**Check current implementation** and update to use:
```typescript
import { createSubjectDescription } from "@/lib/utils/seo/descriptions";

// In generateMetadata:
const description = createSubjectDescription(
  content.title,
  content.description,
  subjectName,
  gradeNumber
);
```

### Step 5: Fix Article Descriptions

**File**: `apps/www/app/[locale]/(study)/(main)/(contents)/articles/[category]/[slug]/page.tsx`

**Update to use**:
```typescript
import { createArticleDescription } from "@/lib/utils/seo/descriptions";

// In generateMetadata:
const description = createArticleDescription(
  article.title,
  article.excerpt || article.description,
  categoryName
);
```

### Step 6: Fix Exercise Descriptions

**File**: `apps/www/app/[locale]/(study)/(main)/(contents)/exercises/[category]/[type]/[material]/[...slug]/page.tsx`

**Update to use**:
```typescript
import { createExerciseDescription } from "@/lib/utils/seo/descriptions";

// In generateMetadata:
const description = createExerciseDescription(
  exercise.title,
  subjectName,
  exercise.difficulty || "all"
);
```

### Step 7: Fix Long Descriptions

**For descriptions >160 chars**:

1. **Identify long descriptions**:
   ```bash
   # Manual check or audit report
   ```

2. **Truncate intelligently**:
   - Cut at sentence boundary if possible
   - Cut at word boundary
   - Add "..." if truncated

3. **Example**:
   - Before: "This is a very long description that goes on and on about the content and includes too many details that aren't necessary for a meta description and exceeds the limit"
   - After: "This is a very long description that goes on and on about the content and includes too many details..."

### Step 8: Add Value Propositions

**Every description should answer**: "Why should I click this?"

**Examples by page type**:

**Quran**:
- "Read the full text, translation, and interpretation."

**Subject Content**:
- "Learn with interactive examples and practice problems."
- "Master this concept with step-by-step explanations."

**Articles**:
- "Read expert insights and educational analysis."
- "Stay informed with our comprehensive coverage."

**Exercises**:
- "Test your knowledge and track your progress."
- "Practice with instant feedback and hints."

### Step 9: Verification

**Check description lengths**:
```bash
# Sample a few pages
curl -s https://nakafa.com/en/quran/1 | grep -o 'meta name="description" content="[^"]*"' | wc -c
# Should be 120-160 chars
```

**Run audit**:
```bash
squirrel audit https://nakafa.com --max-pages 100 --format llm
```

**Check for**:
- [ ] No descriptions <120 characters
- [ ] No descriptions >160 characters
- [ ] No duplicate descriptions
- [ ] All descriptions compelling and unique

---

## üöÄ Next Steps

After this task:
- Next: Task 2.4 - Add Missing H1 Tags
- Next: Task 3.1 - Reduce DOM Size
- Dependencies: Task 2.2 (Title tags)

## üîó Related Tasks

- Task 2.1: Fix JSON-LD Validation Errors (SEO foundation)
- Task 2.2: Fix Title Tags (complementary SEO)
- Task 2.4: Add Missing H1 Tags (page structure)

## ‚ö†Ô∏è Important Notes

### Description Length Best Practices

- **Optimal**: 150-160 characters
- **Maximum**: 160 characters (Google truncates after this)
- **Minimum**: 120 characters (to provide value)

### Description Quality

Good descriptions include:
1. **Primary keyword** - Near the beginning
2. **Value proposition** - Why click?
3. **Call-to-action** - "Read", "Learn", "Practice"
4. **Uniqueness** - Different for every page

**Example**:
- ‚ùå "Vector page" (12 chars, no value)
- ‚úÖ "Learn vector addition with interactive examples. Master this Grade 10 Mathematics concept with practice problems and step-by-step solutions." (138 chars)

### Avoid Duplicate Descriptions

Each page should have unique description:
- ‚ùå Same description on all Quran pages
- ‚úÖ Unique description for each surah

### Localization

Ensure descriptions work in all locales:
- Keep structure similar
- Translate value propositions
- Maintain character limits

### Testing

Test descriptions with:
- Google SERP preview tools
- Social media sharing (Facebook, Twitter)
- Messaging apps (WhatsApp, Telegram)

---

## Progress Update Template

After completing this task, update `plans/website-audit/progress.txt`:

```txt
[YYYY-MM-DD HH:mm] Task 2.3 completed - Fix Meta Descriptions

Key decisions:
- Created utility functions for consistent description generation
- Expanded Quran descriptions to include surah context
- Added value propositions to all descriptions
- Truncated long descriptions intelligently
- Ensured all descriptions are unique

Files changed:
- apps/www/app/[locale]/(study)/(main)/(contents)/quran/[surah]/page.tsx
- apps/www/app/[locale]/(study)/(main)/(contents)/subject/[...slug]/page.tsx
- apps/www/app/[locale]/(study)/(main)/(contents)/articles/[...slug]/page.tsx
- apps/www/app/[locale]/(study)/(main)/(contents)/exercises/[...slug]/page.tsx
- apps/www/lib/utils/seo/descriptions.ts (new file)

Results:
- Pages with description issues: 124 ‚Üí 0
- Average description length: [X] characters
- Duplicate descriptions: [X] ‚Üí 0
- Core SEO score: [X] ‚Üí [X]/100

Blockers/notes:
- [Any issues encountered]
- [Notes for next iteration]
```
