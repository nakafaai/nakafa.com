# Task 2.2: Fix Title Tags (258 Pages)

## üéØ Goal

Fix title tag issues on 258 pages to improve Core SEO score from 81/100 to 90+/100.

## üìç Context

**Current State**: 
- Core SEO score: 81/100
- 258 pages with title issues
- 3 duplicate title patterns affecting 64 pages

**Issues Found**:
1. **Titles too long** (70-113 characters): Many content pages exceed 60 char limit
2. **Titles too short** (11-23 characters): Quran surah pages lack context
3. **Duplicate titles**: 3 patterns affecting 64 pages

**Why This Matters**:
- Titles >60 chars get truncated in Google SERP ("...")
- Short titles waste SEO opportunity
- Duplicate titles confuse search engines
- Title is the #1 on-page SEO ranking factor

## PRD

```json
{
  "category": "seo",
  "description": "Fix title tags on 258 pages to be 30-60 characters, unique, and descriptive",
  "steps": [
    "Identify all pages with title issues",
    "Fix long titles by truncating to 60 chars",
    "Fix short titles by adding descriptive context",
    "Fix duplicate titles by making them unique",
    "Ensure consistent format: [Page Title] - [Site Name]",
    "Test with Google SERP preview tool",
    "Verify all pages have unique titles"
  ],
  "passes": false
}
```

## üé¨ Success Criteria

- [ ] All titles 30-60 characters
- [ ] No duplicate titles across site
- [ ] Quran pages have descriptive titles (not just surah names)
- [ ] Content pages include subject/grade context
- [ ] Consistent format: "[Descriptive Title] - Nakafa"
- [ ] Core SEO score > 90/100
- [ ] All tests pass

## Commands

```bash
# From root directory
pnpm lint
pnpm typecheck
pnpm test

# Audit to verify fixes
squirrel audit https://nakafa.com --max-pages 100 --format llm
```

## üìù Implementation

### Step 1: Analyze Current Title Issues

**Files with generateMetadata** (from grep results):
- Quran pages: `apps/www/app/[locale]/(study)/(main)/(contents)/quran/[surah]/page.tsx`
- Subject pages: `apps/www/app/[locale]/(study)/(main)/(contents)/subject/[...]/page.tsx`
- Article pages: `apps/www/app/[locale]/(study)/(main)/(contents)/articles/[...]/page.tsx`
- Exercise pages: `apps/www/app/[locale]/(study)/(main)/(contents)/exercises/[...]/page.tsx`
- Layout: `apps/www/app/[locale]/layout.tsx`

**Current Quran title generation** (line 96-98):
```typescript
return {
  title: {
    absolute: `${title} - ${t("quran")}`,
  },
  // ...
};
```

**Issue**: Title is just "Al-Fatihah - Quran" (too short, lacks context)

### Step 2: Fix Quran Page Titles

**File**: `apps/www/app/[locale]/(study)/(main)/(contents)/quran/[surah]/page.tsx`

**Current code** (around line 91-104):
```typescript
const title = getSurahName({ locale, name: surahData.name });
const description = surahData.name.translation[locale];

return {
  title: {
    absolute: `${title} - ${t("quran")}`,
  },
  // ...
};
```

**Fixed code**:
```typescript
const surahName = getSurahName({ locale, name: surahData.name });
const surahTranslation = surahData.name.translation[locale];
const surahNumber = surahData.number;

// Create descriptive title: "Surah 1: Al-Fatihah (The Opener) - Quran - Nakafa"
const title = `Surah ${surahNumber}: ${surahName} (${surahTranslation}) - ${t("quran")}`;

return {
  title: {
    absolute: title,
  },
  description: `${surahTranslation} - ${t("quran")} ${surahNumber}`,
  // ...
};
```

**Example improvements**:
- Before: "Al-Fatihah - Quran" (20 chars)
- After: "Surah 1: Al-Fatihah (The Opener) - Quran" (41 chars)

### Step 3: Fix Subject Content Titles

**File**: `apps/www/app/[locale]/(study)/(main)/(contents)/subject/[category]/[grade]/[material]/[...slug]/page.tsx`

**Check current title generation**:
```typescript
// Read the file to see current implementation
```

**Target format**: "[Content Title] - [Subject] Grade [N] - Nakafa"

**Example**:
- Before: "Vector Concept" (14 chars - too short)
- After: "Vector Concept - Mathematics Grade 10 - Nakafa" (46 chars)

### Step 4: Fix Article Titles

**File**: `apps/www/app/[locale]/(study)/(main)/(contents)/articles/[category]/[slug]/page.tsx`

**Target format**: "[Article Title] - [Category] Articles - Nakafa"

**Example**:
- Before: "Understanding Politics" (22 chars)
- After: "Understanding Politics - Educational Articles - Nakafa" (54 chars)

### Step 5: Fix Exercise Titles

**File**: `apps/www/app/[locale]/(study)/(main)/(contents)/exercises/[category]/[type]/[material]/[...slug]/page.tsx`

**Target format**: "[Exercise Title] - [Subject] Practice - Nakafa"

### Step 6: Fix Duplicate Titles

**Identify duplicates** (from audit):
- 3 duplicate title patterns affecting 64 pages

**Common causes**:
1. Generic titles like "Exercise" or "Article"
2. Missing differentiation in dynamic routes
3. Layout-level titles overriding page titles

**Fix strategy**:
1. Add unique identifiers to each page type
2. Include path parameters in titles
3. Ensure no page uses generic fallback titles

### Step 7: Update Layout Default Title

**File**: `apps/www/app/[locale]/layout.tsx`

**Check current default title**:
```typescript
export async function generateMetadata({
  params,
}: {
  params: Promise<{ locale: Locale }>;
}): Promise<Metadata> {
  const { locale } = await params;
  const t = await getTranslations({ locale, namespace: "Metadata" });

  return {
    title: {
      template: `%s - ${t("title")}`,
      default: t("title"),
    },
    // ...
  };
}
```

**Ensure template is consistent**:
- Template: `%s - Nakafa` (or localized equivalent)
- All pages should provide specific `%s` value

### Step 8: Create Title Utility Function

**New file**: `apps/www/lib/utils/seo/titles.ts`

```typescript
import type { Locale } from "next-intl";

const SITE_NAME = "Nakafa";
const MAX_TITLE_LENGTH = 60;

/**
 * Create SEO-friendly title with site name
 * Truncates if exceeds 60 characters
 */
export function createTitle(
  pageTitle: string,
  locale: Locale,
  siteName: string = SITE_NAME
): string {
  const fullTitle = `${pageTitle} - ${siteName}`;
  
  if (fullTitle.length <= MAX_TITLE_LENGTH) {
    return fullTitle;
  }
  
  // Truncate page title to fit within limit
  const maxPageTitleLength = MAX_TITLE_LENGTH - siteName.length - 3; // " - "
  const truncatedPageTitle = pageTitle.slice(0, maxPageTitleLength).trim();
  
  return `${truncatedPageTitle} - ${siteName}`;
}

/**
 * Create title for Quran surah pages
 */
export function createQuranTitle(
  surahNumber: number,
  surahName: string,
  surahTranslation: string,
  locale: Locale
): string {
  return createTitle(
    `Surah ${surahNumber}: ${surahName} (${surahTranslation})`,
    locale
  );
}

/**
 * Create title for subject content pages
 */
export function createSubjectTitle(
  contentTitle: string,
  subject: string,
  grade: number,
  locale: Locale
): string {
  return createTitle(
    `${contentTitle} - ${subject} Grade ${grade}`,
    locale
  );
}

/**
 * Create title for article pages
 */
export function createArticleTitle(
  articleTitle: string,
  category: string,
  locale: Locale
): string {
  return createTitle(
    `${articleTitle} - ${category} Articles`,
    locale
  );
}
```

### Step 9: Verification

**Test titles manually**:
```bash
# Check a few key pages
curl -s https://nakafa.com/en/quran/1 | grep -o "<title>.*</title>"
curl -s https://nakafa.com/en/subject/high-school/10/mathematics | grep -o "<title>.*</title>"
curl -s https://nakafa.com/en/articles/politics | grep -o "<title>.*</title>"
```

**Run audit**:
```bash
squirrel audit https://nakafa.com --max-pages 100 --format llm
```

**Check for**:
- [ ] No titles >60 characters
- [ ] No titles <30 characters
- [ ] No duplicate titles
- [ ] All titles descriptive and unique

---

## üöÄ Next Steps

After this task:
- Next: Task 2.3 - Fix Meta Descriptions
- Next: Task 2.4 - Add Missing H1 Tags
- Dependencies: Task 2.1 (JSON-LD fixes)

## üîó Related Tasks

- Task 2.1: Fix JSON-LD Validation Errors (SEO foundation)
- Task 2.3: Fix Meta Descriptions (complementary SEO)
- Task 2.4: Add Missing H1 Tags (page structure)

## ‚ö†Ô∏è Important Notes

### Title Length Best Practices

- **Optimal**: 50-60 characters
- **Maximum**: 60 characters (before truncation in SERP)
- **Minimum**: 30 characters (to provide value)

### Title Format

Consistent format helps users and SEO:
- `[Specific Page Content] - [Context] - [Site Name]`
- Example: "Vector Addition - Mathematics Grade 10 - Nakafa"

### Avoid Keyword Stuffing

Don't force keywords:
- ‚ùå "Vector Addition Mathematics Math Vectors Grade 10 - Nakafa"
- ‚úÖ "Vector Addition - Mathematics Grade 10 - Nakafa"

### Localization

Ensure titles work in all supported locales:
- English: "Vector Addition - Mathematics Grade 10 - Nakafa"
- Indonesian: "Penjumlahan Vektor - Matematika Kelas 10 - Nakafa"

### Testing Title Length

Use this formula:
```typescript
const title = "Your Title Here";
console.log(`Length: ${title.length}`);
// Should be 30-60
```

---

## Progress Update Template

After completing this task, update `plans/website-audit/progress.txt`:

```txt
[YYYY-MM-DD HH:mm] Task 2.2 completed - Fix Title Tags

Key decisions:
- Created utility functions for consistent title generation
- Fixed Quran titles to include surah number and translation
- Fixed subject content titles to include grade level
- Truncated long titles to 60 character limit
- Eliminated duplicate title patterns

Files changed:
- apps/www/app/[locale]/(study)/(main)/(contents)/quran/[surah]/page.tsx
- apps/www/app/[locale]/(study)/(main)/(contents)/subject/[...slug]/page.tsx
- apps/www/app/[locale]/(study)/(main)/(contents)/articles/[...slug]/page.tsx
- apps/www/app/[locale]/(study)/(main)/(contents)/exercises/[...slug]/page.tsx
- apps/www/lib/utils/seo/titles.ts (new file)

Results:
- Pages with title issues: 258 ‚Üí 0
- Duplicate titles: 64 pages ‚Üí 0
- Average title length: [X] characters
- Core SEO score: 81 ‚Üí [X]/100

Blockers/notes:
- [Any issues encountered]
- [Notes for next iteration]
```
